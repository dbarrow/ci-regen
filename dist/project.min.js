/*! project 24-04-2013 */
"use strict";function BaseListController(e,t){return e.filteredItems=[],e.groupedItems=[],e.pagedItems=[],e.currentPage=0,e.searchMatch=function(e,t){return t?"function"==typeof e||null==e?!1:-1!==e.toLowerCase().indexOf(t.toLowerCase()):!0},e.search=function(){e.filteredItems=t("filter")(e.items,function(t){for(var r in t)if(e.searchMatch(t[r],e.query))return!0;return!1}),""!==e.sortingOrder&&(e.filteredItems=t("orderBy")(e.filteredItems,e.sortingOrder,e.reverse)),e.currentPage=0,e.pagedItems=e.groupToPages()},e.groupToPages=function(){e.pagedItems=[];for(var t=0;e.filteredItems.length>t;t++)0===t%e.itemsPerPage?e.pagedItems[Math.floor(t/e.itemsPerPage)]=[e.filteredItems[t]]:e.pagedItems[Math.floor(t/e.itemsPerPage)].push(e.filteredItems[t]);return e.pagedItems},e.range=function(e,t){var r=[];t||(t=e,e=0);for(var o=e;t>o;o++)r.push(o);return r},e.prevPage=function(){e.currentPage>0&&e.currentPage--},e.nextPage=function(){e.currentPage<e.pagedItems.length-1&&e.currentPage++},e.setPage=function(){e.currentPage=this.n},e.sort_by=function(t){e.sortingOrder==t&&(e.reverse=!e.reverse),e.sortingOrder=t},e}function ProjectListCtrl(e,t,r,o,n){r=new BaseListController(r,o,t),r.$on("event:auth-loginRequired",function(){t.path("/login"),console.log("login required")}),r.$on("event:auth-loginConfirmed",function(){console.log("confirmed")}),r.sortingOrder="id",r.reverse=!0,r.itemsPerPage=10,r.items=n.api.query(function(){r.search()},function(){alert("error")}),r.view=function(e){t.path("/project/"+e.id)},r.getAll=function(){return r.items=n.api.query()},r.getByDesc=function(){r.items=n.api.query({description:r.searchText})},r.create=function(e){n.api.save(e,function(e){r.items.push(e),t.path("/projects")},function(){alert("error")})},r.put=function(){var e=r.items[0],t=e.description;e.description=r.searchText,n.api.update({description:t},{description:e.description},function(e){console.log(e)},function(e){console.log(e)})},r.delete=function(e,t){n.api.delete({id:e.id},function(){r.pagedItems.splice(t,1);for(var o in r.items)if(r.items[o].id==e.id){r.items.splice(o,1);break}r.search()},function(){alert("error")})}}function ProjectViewController(e,t,r,o){t.$on("event:auth-loginRequired",function(){e.path("/login"),console.log("login required")}),t.$on("event:auth-loginConfirmed",function(){console.log("confirmed"),authService.retryAll()}),t.project=o.api.get({id:r.id},function(){}),t.saveProject=function(e){o.api.update({description:desc},{description:e.description},function(e){console.log(e)},function(e){console.log(e)})}}function LoginController(e,t,r,o,n){r.login=function(e){n.api.login(e,function(){t.path("/projects")},function(){alert("error")})},r.logout=function(){n.logout.get(function(){t.path("/login")},function(){alert("error")})}}angular.module("myApp",["myApp.filters","myApp.services","myApp.http-auth-interceptor","myApp.directives","myApp.loginService"]).config(["$routeProvider","$httpProvider",function(e){e.when("/projects",{templateUrl:"partials/projects.html",controller:ProjectListCtrl}),e.when("/view2",{templateUrl:"partials/partial2.html"}),e.when("/project/create",{templateUrl:"partials/new-project.html",controller:ProjectListCtrl}),e.when("/project/:id",{templateUrl:"partials/project-view.html",controller:ProjectViewController}),e.when("/login",{templateUrl:"partials/login.html",controller:LoginController}),e.otherwise({redirectTo:"/projects"})}]),BaseListController.$inject=["$scope","$filter","$location"],angular.module("myApp.directives",[]).directive("appVersion",["version",function(e){return function(t,r){r.text(e)}}]),angular.module("myApp.filters",[]).filter("interpolate",["version",function(e){return function(t){return(t+"").replace(/\%VERSION\%/gm,e)}}]),ProjectListCtrl.$inject=["$rootScope","$location","$scope","$filter","Projects","authService"],LoginController.$inject=["$rootScope","$location","$scope","authService","Login"],angular.module("myApp.services",["ngResource"]).config(["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",delete e.defaults.headers.common["X-Requested-With"]}]).factory("Projects",["$resource","$http","$rootScope",function(e){return{api:e("http://api.traversepoint.com/api/projects/:id",{},{update:{method:"PUT"}})}}]),function(){angular.module("myApp.http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(e,t){return{loginConfirmed:function(r){console.log("login conitmed"),e.$broadcast("event:auth-loginConfirmed",r),t.retryAll()}}}]).config(["$httpProvider",function(e){var t=["$rootScope","$q","httpBuffer",function(e,t,r){function o(e){return e}function n(o){if(401===o.status&&!o.config.ignoreAuthModule){var n=t.defer();return r.append(o.config,n),e.$broadcast("event:auth-loginRequired"),n.promise}return t.reject(o)}return function(e){return e.then(o,n)}}];e.responseInterceptors.push(t)}]),angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(e){function t(t,o){function n(e){o.resolve(e)}function i(e){o.reject(e)}r=r||e.get("$http"),r(t).then(n,i)}var r,o=[];return{append:function(e,t){o.push({config:e,deferred:t})},retryAll:function(){for(var e=0;o.length>e;++e)t(o[e].config,o[e].deferred);o=[]}}}])}(),angular.module("myApp.loginService",["ngResource"]).config(["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",delete e.defaults.headers.common["X-Requested-With"];var t=["$rootScope","$q",function(t,r){function o(t){if(t.headers("API")){var o=r.defer();return window.localStorage.setItem("apikey",t.headers("API")),o.promise}e.defaults.headers.common.API=window.localStorage.getItem("apikey")}function n(){}return function(e){return e.then(o,n)}}];e.responseInterceptors.push(t)}]).factory("Login",["$resource","$http","$rootScope",function(e){return{api:e("http://api.traversepoint.com/api_auth/login",{},{login:{method:"POST"}}),logout:e("http://api.traversepoint.com/api_auth/logout",{},{})}}]);